<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/getScriptsByGenre.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">All files</a> / <a href="index.html">src</a> getScriptsByGenre.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/52</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/10</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/9</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/50</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85</td><td class="line-coverage quiet"><span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">const _ = <span class="cstat-no" title="statement not covered" >require('lodash');</span>
const string = <span class="cstat-no" title="statement not covered" >require('string');</span>
const api = <span class="cstat-no" title="statement not covered" >require('./helper/api');</span>
const getScript = <span class="cstat-no" title="statement not covered" >require('./getScript');</span>
const { checkDirectory, removeExtraScripts } = <span class="cstat-no" title="statement not covered" >require('./helper/fileSystem');</span>
const randomIntFromInterval = <span class="cstat-no" title="statement not covered" >require('./helper/randomIntFromInterval');</span>
const cleanArr = <span class="cstat-no" title="statement not covered" >require('./helper/cleanArr');</span>
const isValidGenre = <span class="cstat-no" title="statement not covered" >require('./helper/isValidGenre');</span>
const handleError = <span class="cstat-no" title="statement not covered" >require('./helper/handleError');</span>
&nbsp;
const removeInvalidURLs = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >ur</span>ls =&gt; {</span>
<span class="cstat-no" title="statement not covered" >	return _.remove(urls, <span class="fstat-no" title="function not covered" >ur</span>l =&gt; {</span>
<span class="cstat-no" title="statement not covered" >		return string(url).contains('.html');</span>
	});
};
&nbsp;
const shouldRandomlySave = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >()</span> =&gt; {</span>
	const totalRandomNumber = <span class="cstat-no" title="statement not covered" >randomIntFromInterval(0, 1000);</span>
<span class="cstat-no" title="statement not covered" >	return totalRandomNumber % 17 === 0;</span>
};
&nbsp;
const addScriptsToDir = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >as</span>ync (urls, options) =&gt; {</span>
	const { genre, dest } = <span class="cstat-no" title="statement not covered" >options;</span>
	const total = <span class="cstat-no" title="statement not covered" >options.total * 3;</span>
	let totalCounter = <span class="cstat-no" title="statement not covered" >0;</span>
&nbsp;
	const cleaned = <span class="cstat-no" title="statement not covered" >removeInvalidURLs(urls);</span>
<span class="cstat-no" title="statement not covered" >	await checkDirectory(dest, genre);</span>
&nbsp;
	// Loop through script URLs
	const promiseArr = <span class="cstat-no" title="statement not covered" >await cleaned.map(<span class="fstat-no" title="function not covered" >as</span>ync url =&gt; {</span>
<span class="cstat-no" title="statement not covered" >		if (totalCounter === total) <span class="cstat-no" title="statement not covered" >return;</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >		if (shouldRandomlySave()) {</span>
<span class="cstat-no" title="statement not covered" >			++totalCounter;</span>
&nbsp;
			const filePath = <span class="cstat-no" title="statement not covered" >await getScript(url, options);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >			return filePath;</span>
		}
	});
&nbsp;
<span class="cstat-no" title="statement not covered" >	return Promise.all(promiseArr).then(<span class="fstat-no" title="function not covered" >da</span>ta =&gt; {</span>
<span class="cstat-no" title="statement not covered" >		return data;</span>
	});
};
&nbsp;
const isValid = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >ur</span>ls =&gt; {</span>
<span class="cstat-no" title="statement not covered" >	return urls.length === 0;</span>
};
&nbsp;
const handleURLs = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >ht</span>ml =&gt; {</span>
	// RegEx URLs
	const pattern = <span class="cstat-no" title="statement not covered" >/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&amp;=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&amp;=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&amp;;%@.\w_]*)#?(?:[\w]*))?)/gi;</span> // eslint-disable-line no-useless-escape
	const urls = <span class="cstat-no" title="statement not covered" >html.match(pattern) || [];</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	if (isValid(urls)) <span class="cstat-no" title="statement not covered" >return null;</span></span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	return urls;</span>
};
&nbsp;
const getScriptsByGenre = <span class="cstat-no" title="statement not covered" ><span class="fstat-no" title="function not covered" >as</span>ync options =&gt; {</span>
	const { genre } = <span class="cstat-no" title="statement not covered" >options;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >	if (isValidGenre(genre)) {</span>
<span class="cstat-no" title="statement not covered" >		try {</span>
			const url = <span class="cstat-no" title="statement not covered" >`http://www.imsdb.com/feeds/genre.php?genre=${genre}`;</span>
			const rawURLs = <span class="cstat-no" title="statement not covered" >await api(url);</span>
			const urls = <span class="cstat-no" title="statement not covered" >handleURLs(rawURLs);</span>
			const filePaths = <span class="cstat-no" title="statement not covered" >await addScriptsToDir(urls, options);</span>
			const cleanFilePaths = <span class="cstat-no" title="statement not covered" >cleanArr(filePaths);</span>
			const prunedFilePaths = <span class="cstat-no" title="statement not covered" >await removeExtraScripts(</span>
				cleanFilePaths,
				options.total
			);
<span class="cstat-no" title="statement not covered" >			return prunedFilePaths;</span>
		} catch (err) {
<span class="cstat-no" title="statement not covered" >			return handleError(err);</span>
		}
	}
<span class="cstat-no" title="statement not covered" >	handleError('Invalid Genre');</span>
};
&nbsp;
<span class="cstat-no" title="statement not covered" >module.exports = getScriptsByGenre;</span>
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Sun Jan 21 2018 17:13:28 GMT-0600 (CST)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
